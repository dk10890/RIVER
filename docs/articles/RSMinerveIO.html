<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RS Minerve IO use cases â€¢ riversCentralAsia</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="RS Minerve IO use cases">
<meta property="og:description" content="riversCentralAsia">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">riversCentralAsia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00-introduction.html">Introduction to the package</a>
    </li>
    <li>
      <a href="../articles/glaciers-01-intro.html">Glaciers 01 - Introduction &amp; Data</a>
    </li>
    <li>
      <a href="../articles/glaciers-02-DDMWB.html">Glaciers 02 - Modelling discharge from glaciers</a>
    </li>
    <li>
      <a href="../articles/glaciers-03-oerlemans.html">Glaciers 03 - Estimating glacier lengths in Central Asia</a>
    </li>
    <li>
      <a href="../articles/glaciers-04-glaciers-RSM.html">Glaciers 04 - Glacier discharge in RS Minerve</a>
    </li>
    <li>
      <a href="../articles/RSMinerveIO.html">RS Minerve IO use cases</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hydrosolutions/riversCentralAsia/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>RS Minerve IO use cases</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hydrosolutions/riversCentralAsia/blob/HEAD/vignettes/RSMinerveIO.rmd" class="external-link"><code>vignettes/RSMinerveIO.rmd</code></a></small>
      <div class="hidden name"><code>RSMinerveIO.rmd</code></div>

    </div>

    
    
<p>This chapter demonstrates a few common use cases of RS Minerve I/O
functions.</p>
<div class="section level2">
<h2 id="preparation-of-climate-forcing-database">Preparation of climate forcing database<a class="anchor" aria-label="anchor" href="#preparation-of-climate-forcing-database"></a>
</h2>
<p>One work flow often employed is the preparation of climate input data
base files which is amply demonstrated in the <a href="https://hydrosolutions.github.io/caham_book/climate_data.html#sec-climate-projections" target="_blank" class="external-link">CAHAM book</a></p>
</div>
<div class="section level2">
<h2 id="reading-and-writing-of-model-parameter-files">Reading and writing of model parameter files<a class="anchor" aria-label="anchor" href="#reading-and-writing-of-model-parameter-files"></a>
</h2>
<p>Writing parameter files for import to RS Minerve can speed up the
configuration of large models or the manual calibration of snow related
parameters (as there is no inbuilt method to calibrate snow water
equivalents in RS Minerve yet, status May 2022). The process is
demonstrated in the code chunk below.</p>
<p>Please note that not all objects implemented in RS Minerve are also
supported in this present versions of <code>readRSMParameters</code> and
<code>writeRSMParameters</code> of the <code>riversCentralAsia</code>
package. See section below for a list of supported objects.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## -- <span style="font-weight: bold;">Attaching packages</span> --------------------------------------- tidyverse 1.3.1 --</span></code></pre>
<pre><code><span class="co">## <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">ggplot2</span> 3.3.5     <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">purrr  </span> 0.3.4</span>
<span class="co">## <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">tibble </span> 3.1.6     <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">dplyr  </span> 1.0.9</span>
<span class="co">## <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">tidyr  </span> 1.2.0     <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">stringr</span> 1.4.0</span>
<span class="co">## <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">readr  </span> 2.1.2     <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">forcats</span> 0.5.1</span></code></pre>
<pre><code><span class="co">## -- <span style="font-weight: bold;">Conflicts</span> ------------------------------------------ tidyverse_conflicts() --</span>
<span class="co">## <span style="color: #BB0000;">x</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span>
<span class="co">## <span style="color: #BB0000;">x</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/remote-reexports.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"hydrosolutions/riversCentralAsia"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Skipping install of 'riversCentralAsia' from a github remote, the SHA1 (47c4e80c) has not changed since last install.</span>
<span class="co">##   Use `force = TRUE` to force installation</span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hydrosolutions.github.io/riversCentralAsia/index.html" class="external-link">riversCentralAsia</a></span><span class="op">)</span>

<span class="co"># 1. Export a default parameter file for your model in RS Minerve</span>

<span class="co"># 2. Import the model parameters in R</span>
<span class="va">filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"../tests/testthat/Tutorial_Parameters.txt"</span><span class="op">)</span><span class="op">)</span>
<span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readRSMParameters.html">readRSMParameters</a></span><span class="op">(</span><span class="va">filepath</span><span class="op">)</span>

<span class="co"># 3. Perform your edits (in this case, halve the glacier melt release coefficient)</span>
<span class="va">params</span> <span class="op">&lt;-</span> <span class="va">params</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">(</span><span class="va">Object</span> <span class="op">==</span> <span class="st">"GSM"</span> <span class="op">&amp;</span> <span class="va">Parameters</span> <span class="op">==</span> <span class="st">"Kgl [1/d]"</span><span class="op">)</span>,
                         <span class="va">Values</span><span class="op">/</span><span class="fl">2</span>, <span class="va">Values</span><span class="op">)</span><span class="op">)</span>

<span class="co"># 4. Write the edited parameters and import them into RS Minerve</span>
<span class="fu"><a href="../reference/writeRSMParameters.html">writeRSMParameters</a></span><span class="op">(</span><span class="va">params</span>, 
                   <span class="st">"../../atbashy_glacier_demo_data/RSMINERVE/params.txt"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## NULL</span></code></pre>
<div class="section level3">
<h3 id="rs-minerve-objects-supported-in-riverscentralasia">RS Minerve objects supported in <code>riversCentralAsia</code><a class="anchor" aria-label="anchor" href="#rs-minerve-objects-supported-in-riverscentralasia"></a>
</h3>
<p>The following RSMinerve objects are currently supported in the
<code>riversCentralAsia</code> package:<br>
- Station<br>
- Source<br>
- SOCONT<br>
- Kinematic<br>
- Junction<br>
- GSM<br>
- HBV92<br>
- Comparator</p>
<p>The parameters for these objects are described in the RS Minerve User
Manual available from the <a href="https://www.crealp.ch/fr/accueil/outils-services/logiciels/rs-minerve/telechargement-rsm.html" class="external-link">CREALP
website</a>. The format of the parameter file is described below:</p>
</div>
</div>
<div class="section level2">
<h2 id="writing-check-node-files">Writing check node files<a class="anchor" aria-label="anchor" href="#writing-check-node-files"></a>
</h2>
<p>In RS Minerve, simulation results can be viewed in the selection and
plots tab and exported to csv file format. To export model states or
fluxes from large models can be time consuming to set up manually. The
following code chunk demonstrates how to write a check node file for the
export of snow water equivalent from all HBV modules in the RS Minerve
model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Linking to GEOS 3.9.1, GDAL 3.2.1, PROJ 7.2.1; sf_use_s2() is TRUE</span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/remote-reexports.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"hydrosolutions/riversCentralAsia"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Skipping install of 'riversCentralAsia' from a github remote, the SHA1 (47c4e80c) has not changed since last install.</span>
<span class="co">##   Use `force = TRUE` to force installation</span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hydrosolutions.github.io/riversCentralAsia/index.html" class="external-link">riversCentralAsia</a></span><span class="op">)</span>

<span class="co"># Get the model object IDs, here from the GIS layer used for automated model creation </span>
<span class="va">Object_IDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"../../atbashy_glacier_demo_data/GIS/16076_HRU.shp"</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<pre><code><span class="co">## Reading layer `16076_HRU' from data source </span>
<span class="co">##   `C:\Users\marti\Dropbox (hydrosolutions)\marti\github\atbashy_glacier_demo_data\GIS\16076_HRU.shp' </span>
<span class="co">##   using driver `ESRI Shapefile'</span>
<span class="co">## Simple feature collection with 40 features and 3 fields</span>
<span class="co">## Geometry type: MULTIPOLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: 1105700 ymin: 4575416 xmax: 1197076 ymax: 4616616</span>
<span class="co">## Projected CRS: WGS 84 / UTM zone 42N</span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generate a table for each variable per model object to be visualized or </span>
<span class="co"># exported in RS Minerve</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
  Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Model Atbasy"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Object_IDs</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span>, 
  Object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"HBV92"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Object_IDs</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
  ID <span class="op">=</span> <span class="va">Object_IDs</span><span class="op">$</span><span class="va">name</span>, 
  Variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"SWE (m)"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Write the check node file which can then be imported in RS Minerve </span>
<span class="fu"><a href="../reference/writeSelectionCHK.html">writeSelectionCHK</a></span><span class="op">(</span>filepath <span class="op">=</span> <span class="st">"../../atbashy_glacier_demo_data/RSMINERVE/SWE.chk"</span>, 
                  data <span class="op">=</span> <span class="va">data</span>, 
                  name <span class="op">=</span> <span class="st">"SWE"</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tobias Siegfried, Beatrice Marti.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
