<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glaciers 02 - Temperature index model • riversCentralAsia</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Glaciers 02 - Temperature index model">
<meta property="og:description" content="riversCentralAsia">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">riversCentralAsia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00-introduction.html">Introduction to the package</a>
    </li>
    <li>
      <a href="../articles/glaciers-01-intro.html">Glaciers 01 - Intro</a>
    </li>
    <li>
      <a href="../articles/glaciers-02-DDMWB.html">Glaciers 02 - Temperature index model</a>
    </li>
    <li>
      <a href="../articles/glaciers-03-oerlemans.html">Glaciers 03 - Estimating glacier lengths in Central Asia</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hydrosolutions/riversCentralAsia/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="glaciers-02-DDMWB_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Glaciers 02 - Temperature index model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hydrosolutions/riversCentralAsia/blob/master/vignettes/glaciers-02-DDMWB.rmd"><code>vignettes/glaciers-02-DDMWB.rmd</code></a></small>
      <div class="hidden name"><code>glaciers-02-DDMWB.rmd</code></div>

    </div>

    
    
<div id="temperature-index-model" class="section level1">
<h1 class="hasAnchor">
<a href="#temperature-index-model" class="anchor"></a>Temperature index model</h1>
<p>@hock_temperature_2003 describes several variants of the temperature
index model for simulating glacier melt. The riversCentralAsia package
implements the temperature index melt model described in <span class="citation">(Hock 2003)</span> in the function .</p>
<p><span class="math display">\[
M = \biggl\{ \begin{array}{l, l}
0, &amp; T &lt; T_{threshold} \\
MF \cdot \left( T - T_{threshold} \right), &amp; T &gt;= T_{threshold}
\end{array}
\]</span></p>
<p>where <span class="math inline">\(M\)</span> is the glacier melt in
<span class="math inline">\(mm/d\)</span>, <span class="math inline">\(T\)</span> is the daily average temperature in
<span class="math inline">\(^{\circ} C\)</span>. The two parameters
<span class="math inline">\(MF\)</span> and <span class="math inline">\(T_{\text{threshold}}\)</span> refer to the melt
factor and the threshold temperature above which glacier melt occurs and
need to be calibrated. They have the units <span class="math inline">\(\frac{mm}{^{\circ} C \cdot d}\)</span> and <span class="math inline">\(^{\circ} C\)</span> respectively. Glacier melt is
calculated in daily time steps.</p>
</div>
<div id="glacier-mass-balance" class="section level1">
<h1 class="hasAnchor">
<a href="#glacier-mass-balance" class="anchor"></a>Glacier mass balance</h1>
<p>We simplify the glacier mass balance to the following equation</p>
<p><span class="math display">\[
\Delta S = P-M = A_{imbal}
\]</span></p>
<p>where the change of water storage (<span class="math inline">\(\Delta
S\)</span>) is equal to the precipitation (<span class="math inline">\(P\)</span>, assumed solid) minus the glacier melt
(<span class="math inline">\(M\)</span>). Typically melt excesses
precipitation and we have negative imbalance ablation, indicating
glacier storage loss. The glacier mass balance is calculated in annual
time steps. We thereby refer to the hydrological year starting on
October 1st of the previous year to take a full accumulation and
ablation season into account.</p>
</div>
<div id="glacier-volume-development" class="section level1">
<h1 class="hasAnchor">
<a href="#glacier-volume-development" class="anchor"></a>Glacier volume development</h1>
<p>As glaciers melt, their volume changes. This has to be taken into
account for the long-term simulation of glacier discharge. The glacier
volume develops according to the mass change. To determine the initial
glacier volume we use the area of the geometry of the <a href="glaciers-01-intro.html">RGI v6.0 data set</a> and multiply it with
the average <a href="glaciers-01-intro.html">thickness of the
glacier</a>. Glaciers larger than 1km2 we sub-divide into elevation
bands of 100m altitude to account for elevation dependent temperature
forcing.</p>
<p>For annual time step <span class="math inline">\(t\)</span>, the
evolution of the glacier volume is calculated as follows:</p>
<p><span class="math display">\[
A(t) = \text{glacierArea_RGIF}\bigl(V(t)\bigr)
\]</span></p>
<p><span class="math display">\[
Q_{glacier}(t) = M(t) \cdot A(t)
\]</span></p>
<p><span class="math display">\[
V(t+1) = V(t) + \Delta S = V(t) +
\text{glacierImbalAbl}\bigl(Q_{\text{glacier}}(t)\bigr)
\]</span></p>
<p>Note that the imbalance ablation (or <span class="math inline">\(\Delta S\)</span>) is negative for glacier mass
loss and positive for glacier accumulation.</p>
<p><span class="math inline">\(Q_{\text{glacier}}\)</span> can be
calibrated against glacier discharge derived from the Miles &amp;
Hugonnet data sets.</p>
<p>The function is an empirical scaling function analogue the inverse of
the scaling function derived by <span class="citation">Erasov
(1968)</span> but based on the modern RGI v6.0 glacier geometries and
the glacier thickness data set by <span class="citation">Farinotti et
al. (2019)</span>. The package implements volume-area and area-volume
scaling functions based on both, Erashov and RGI-Farinotti data,
allowing the estimation of glacier areas based on glacier volumes
(\code{glacierArea_Erasov} and \code{glacierArea_RGIF}) and estimations
of glacier volumes based on glacier areas (\code{glacierVolume_Erasov}
and \code{glacierVolume_RGIF}).</p>
<p>The function is an empirical scaling function relating total glacier
melt to imbalance ablation. It is derived from the glacier discharge
data set by <span class="citation">Miles et al. (2021)</span>.</p>
</div>
<div id="forcing" class="section level1">
<h1 class="hasAnchor">
<a href="#forcing" class="anchor"></a>Forcing</h1>
<p>There will be a separate Vignette to demonstrate how to prepare the
forcing. For now, we provide you with the pre-processed forcing data and
give you just a brief overview over the data source.</p>
<div id="historical-tempratures" class="section level2">
<h2 class="hasAnchor">
<a href="#historical-tempratures" class="anchor"></a>Historical tempratures</h2>
<p>As meteorological data for high elevations in Central Asia is very
scarce we use the CHELSA v2.1 data set. This is a global data set of
forcing data for hydrolgical models based on ERA5 but corrected for
biases and for high elevations. The daily CHELSA forcing has been cut to
the Central Region by the originator of the data set, D. Karger,
WSL.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#| fig.cap = "Daily temperature time series of a glacier. Data source: CHELSA." </span>
<span class="co">#| out.width = 90%</span>
<span class="va">hist_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"hist_obs_glacier_tas.rds"</span><span class="op">)</span>

<span class="co"># Plot the temperature time series for a given glacier/elevation band</span>
<span class="va">glacier</span> <span class="op">&lt;-</span> <span class="st">"RGI60-13.08930_1"</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">hist_obs</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">date</span>, <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">glacier</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"T [deg C]"</span>, title <span class="op">=</span> <span class="va">glacier</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="glaciers-02-DDMWB_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div id="future-temperatures" class="section level2">
<h2 class="hasAnchor">
<a href="#future-temperatures" class="anchor"></a>Future temperatures</h2>
<p>Future temperature development per glacier or elevation band is
extracted from the 4 CMIP6 GCM models with highest priorities for the
region () downloaded from COPERNICUS. We take 4 socioeconomic scenarios
into account, covering 4 different emission scenarios. The temperatures
of the climate models are bias corrected using the CHELSA data and a
quantile mapping method.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#| fig.cap = "Annual historical (CHELSA) and future (CMIP6, Copernicus) temperature for a glacier. " </span>
<span class="co">#| out.width = 90%</span>
<span class="va">fut_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"fut_sim_glacier_tas_qmapped.RDS"</span><span class="op">)</span>

<span class="co"># Plot the temperature time series for a given glacier/elevation band</span>
<span class="va">glacier</span> <span class="op">&lt;-</span> <span class="st">"RGI60-13.08930_1"</span>

<span class="co"># Extract the temperature for the selected glaciers for all GCMs and SSPs</span>
<span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fut_sim</span><span class="op">)</span>
<span class="va">fut_temp</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">scenario</span> <span class="kw">in</span> <span class="va">scenarios</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">fut_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">fut_temp</span>, 
                    <span class="va">fut_sim</span><span class="op">[[</span><span class="va">scenario</span><span class="op">]</span><span class="op">]</span> |&gt; 
                      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="fu">all_of</span><span class="op">(</span><span class="va">glacier</span><span class="op">)</span><span class="op">)</span> |&gt; 
                      <span class="fu">mutate</span><span class="op">(</span>Scenario <span class="op">=</span> <span class="va">scenario</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">fut_temp</span> <span class="op">&lt;-</span> <span class="va">fut_temp</span> |&gt; 
  <span class="fu">mutate</span><span class="op">(</span>Hyear <span class="op">=</span> <span class="fu"><a href="../reference/hyear.html">hyear</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">Hyear</span>, <span class="va">Scenario</span><span class="op">)</span> |&gt; 
  <span class="fu">summarise</span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">first</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span>, 
            Temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">glacier</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu">separate</span><span class="op">(</span><span class="va">Scenario</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GCM"</span>, <span class="st">"SSP"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> |&gt; 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Hyear</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">Hyear</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">Hyear</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Hyear</span><span class="op">)</span>, 
                <span class="va">GCM</span> <span class="op">!=</span> <span class="st">"IPSL-CM6A-LR"</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'Hyear'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot annual data for better readability</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">hist_obs</span> |&gt; 
              <span class="fu">mutate</span><span class="op">(</span>Hyear <span class="op">=</span> <span class="fu"><a href="../reference/hyear.html">hyear</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> |&gt; 
              <span class="fu">group_by</span><span class="op">(</span><span class="va">Hyear</span><span class="op">)</span> |&gt; 
              <span class="fu">summarise</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">first</span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, 
                        Temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">glacier</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; 
              <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> |&gt; 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Hyear</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">Hyear</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">Hyear</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Hyear</span><span class="op">)</span><span class="op">)</span>, 
            <span class="fu">aes</span><span class="op">(</span><span class="va">date</span>, <span class="va">Temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">fut_temp</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Date</span>, <span class="va">Temp</span>, colour <span class="op">=</span> <span class="va">GCM</span>, 
            linetype <span class="op">=</span> <span class="va">SSP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_colour_viridis_d</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"T [deg C]"</span>, title <span class="op">=</span> <span class="va">glacier</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="glaciers-02-DDMWB_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
</div>
<div id="demonstration" class="section level1">
<h1 class="hasAnchor">
<a href="#demonstration" class="anchor"></a>Demonstration</h1>
<p>We demonstrate the above described method with the data from the
Atbashy basin.</p>
<div id="calculate-daily-glacier-melt" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-daily-glacier-melt" class="anchor"></a>Calculate daily glacier melt</h2>
<div id="glacier-geometry" class="section level3">
<h3 class="hasAnchor">
<a href="#glacier-geometry" class="anchor"></a>Glacier geometry</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load a shape file with elevation bands for the larger glaciers.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"vignette_glacier_melt"</span><span class="op">)</span>

<span class="co"># Only keep the variables we need for this analysis</span>
<span class="va">rgi_elbands</span> <span class="op">&lt;-</span> <span class="va">rgi_elbands</span> |&gt; 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">RGIId</span>, <span class="va">Area</span>, <span class="va">elvtn_b</span><span class="op">)</span> |&gt; 
  <span class="fu">rename</span><span class="op">(</span>Area_tot_glacier_km2 <span class="op">=</span> <span class="va">Area</span><span class="op">)</span> |&gt; 
  <span class="fu">mutate</span><span class="op">(</span>ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">RGIId</span>, <span class="st">"_"</span>, <span class="va">elvtn_b</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Get mean elevation of each glacier/elevation band from DEM</span>
<span class="va">rgi_elbands</span><span class="op">$</span><span class="va">z_masl</span> <span class="op">&lt;-</span> <span class="fu">exact_extract</span><span class="op">(</span><span class="va">dem</span>, <span class="va">rgi_elbands</span>, <span class="st">"mean"</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Update the glacier area within the basin boundaries</span>
<span class="va">rgi_elbands</span><span class="op">$</span><span class="va">A_km2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">st_area</span><span class="op">(</span><span class="va">rgi_elbands</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">6</span><span class="op">)</span>
<span class="va">glaciers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">rgi_elbands</span><span class="op">$</span><span class="va">RGIId</span><span class="op">)</span>

<span class="co"># Glacier thickness for elevation bands</span>
<span class="va">rgi_elbands</span><span class="op">$</span><span class="va">thickness_m</span> <span class="op">=</span> <span class="fu">exact_extract</span><span class="op">(</span><span class="va">glacier_thickness</span>, 
                                        <span class="va">rgi_elbands</span>, <span class="st">"mean"</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div id="forcing-1" class="section level3">
<h3 class="hasAnchor">
<a href="#forcing-1" class="anchor"></a>Forcing</h3>
<p>When simulating glacier melt, you would typically extract a
temperature time series for each glacier/elevation band. In this
vignette, we only have 1 time series <span class="math inline">\(T_0\)</span> at mean glacier elevation <span class="math inline">\(z_0\)</span> to save storage space. We therefore
first have to generate synthetic temperature time series for each
glaciers/elevation band <span class="math inline">\(i\)</span> using a
typical temperature lapse rate <span class="math inline">\(r_{\text{lapse}}\)</span> for mountainous regions
as follows:</p>
<p><span class="math display">\[
\frac{\Delta T}{\Delta z} = \frac{T_0-T_i}{z_0-z_i} = r_{\text{lapse}} =
-\frac{6.5 ^{\circ}C}{1000 m}
\]</span></p>
<p><span class="math display">\[
T_{i} = T_{0} + r_{\text{lapse}} \cdot (z_{0} - z_{i})
\]</span></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#| fig.cap = "Synthetic forcing for the elevation bands of a glacier. " </span>
<span class="co">#| out.width = 90%</span>
<span class="va">glacier</span> <span class="op">&lt;-</span> <span class="st">"RGI60-13.08930_1"</span>
<span class="va">z_glacier</span> <span class="op">&lt;-</span> <span class="va">rgi_elbands</span><span class="op">$</span><span class="va">z_masl</span><span class="op">[</span><span class="va">rgi_elbands</span><span class="op">$</span><span class="va">ID</span> <span class="op">==</span> <span class="va">glacier</span><span class="op">]</span>
<span class="va">temperature_laps_rate</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">6.5</span><span class="op">/</span><span class="fl">1000</span>  <span class="co"># deg K / 1000 m </span>

<span class="co"># Generate synthetic temperature time series for each glacier &amp; elevation band in </span>
<span class="co"># the basin. </span>
<span class="va">z_glaciers</span> <span class="op">&lt;-</span> <span class="va">rgi_elbands</span> |&gt; 
  <span class="fu">st_drop_geometry</span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">z_masl</span><span class="op">)</span> |&gt; 
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">ID</span>, values_from <span class="op">=</span> <span class="va">z_masl</span><span class="op">)</span>

<span class="va">hrus</span> <span class="op">&lt;-</span> <span class="va">rgi_elbands</span><span class="op">$</span><span class="va">ID</span>
<span class="va">t_glaciers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">hist_obs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">t_glaciers</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">hru</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">hrus</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">t_glaciers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">t_glaciers</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">t_glaciers</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="va">temperature_laps_rate</span> <span class="op">*</span> 
    <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">z_glaciers</span><span class="op">[</span><span class="va">hru</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">z_glaciers</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span> 
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">t_glaciers</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="va">hrus</span><span class="op">)</span> 
<span class="va">t_glaciers</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">t_glaciers</span><span class="op">)</span>
<span class="va">t_glaciers</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu">as_date</span><span class="op">(</span><span class="va">t_glaciers</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>
<span class="va">t_glaciers</span> <span class="op">&lt;-</span> <span class="va">t_glaciers</span> |&gt; 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"RGI"</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">t_glaciers</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> |&gt; 
         <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">date</span>, names_to <span class="op">=</span> <span class="st">"ID"</span>, values_to <span class="op">=</span> <span class="st">"Temp"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">date</span>, <span class="va">Temp</span>, colour <span class="op">=</span> <span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_colour_viridis_d</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"T [deg C]"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="glaciers-02-DDMWB_files/figure-html/temperature_elevation_bands-1.png" width="700"></p>
</div>
<div id="calculating-glacier-melt" class="section level3">
<h3 class="hasAnchor">
<a href="#calculating-glacier-melt" class="anchor"></a>Calculating glacier melt</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#| fig.cap = "Daily glacier melt per elevation band." </span>
<span class="co">#| out.width = 90%</span>
<span class="va">MF</span> <span class="op">=</span> <span class="fl">3</span>
<span class="va">threshold_temperature</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>
<span class="va">Area</span> <span class="op">&lt;-</span> <span class="va">rgi_elbands</span> |&gt; 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">A_km2</span><span class="op">)</span> |&gt; 
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">ID</span>, values_from <span class="op">=</span> <span class="va">A_km2</span><span class="op">)</span>

<span class="va">melt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/glacierMelt_TI.html">glacierMelt_TI</a></span><span class="op">(</span>temperature <span class="op">=</span> <span class="va">t_glaciers</span> |&gt; <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">date</span><span class="op">)</span>,
                       MF <span class="op">=</span> <span class="va">MF</span>,
                       threshold_temperature <span class="op">=</span> <span class="va">threshold_temperature</span><span class="op">)</span>
<span class="va">melt</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">melt</span><span class="op">)</span> |&gt; 
  <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="va">t_glaciers</span><span class="op">$</span><span class="va">date</span><span class="op">)</span> |&gt; 
  <span class="fu">relocate</span><span class="op">(</span><span class="va">date</span>, .before <span class="op">=</span>  <span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">melt</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> |&gt; 
         <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">date</span>, names_to <span class="op">=</span> <span class="st">"ID"</span>, values_to <span class="op">=</span> <span class="st">"Melt"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">date</span>, <span class="va">Melt</span>, colour <span class="op">=</span> <span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_colour_viridis_d</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Melt [mm/d]"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="glaciers-02-DDMWB_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-erasov_1968" class="csl-entry">
Erasov, N. V. 1968. <span>“Method for Determining of Volume of Mountain
Glaciers.”</span> <em>MGI</em>, no. 14: 307–8.
</div>
<div id="ref-farinotti_consensus_2019" class="csl-entry">
Farinotti, Daniel, Matthias Huss, Johannes J. Fürst, Johannes Landmann,
Horst Machguth, Fabien Maussion, and Ankur Pandit. 2019. <span>“A
Consensus Estimate for the Ice Thickness Distribution of All Glaciers on
<span>Earth</span>.”</span> <em>Nature Geoscience</em> 12 (3): 168–73.
<a href="https://doi.org/10.1038/s41561-019-0300-3">https://doi.org/10.1038/s41561-019-0300-3</a>.
</div>
<div id="ref-hock_temperature_2003" class="csl-entry">
Hock, Regine. 2003. <span>“Temperature Index Melt Modelling in Mountain
Areas.”</span> <em>Journal of Hydrology</em> 282 (1): 104–15. <a href="https://doi.org/10.1016/S0022-1694(03)00257-9">https://doi.org/10.1016/S0022-1694(03)00257-9</a>.
</div>
<div id="ref-miles_health_2021" class="csl-entry">
Miles, Evan, Michael McCarthy, Amaury Dehecq, Marin Kneib, Stefan
Fugger, and Francesca Pellicciotti. 2021. <span>“Health and
Sustainability of Glaciers in <span>High</span> <span>Mountain</span>
<span>Asia</span>.”</span> <em>Nature Communications</em> 12 (2868): 10.
https://doi.org/<a href="https://doi.org/10.1038/s41467-021-23073-4">https://doi.org/10.1038/s41467-021-23073-4</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Tobias Siegfried, Beatrice Marti.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
